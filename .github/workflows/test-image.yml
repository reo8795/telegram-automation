name: Fear Greed Index Test

on:
  workflow_dispatch:

jobs:
  test-fear-greed-image:
    runs-on: ubuntu-latest
    
    steps:
    - name: Send CNN Fear Greed Index Image Test
      run: |
        echo "ê³µí¬íƒìš•ì§€ìˆ˜ ì´ë¯¸ì§€ í…ŒìŠ¤íŠ¸ ì‹œì‘"
        
        # CNN ê³µí¬íƒìš•ì§€ìˆ˜ ì´ë¯¸ì§€ ì „ì†¡ í…ŒìŠ¤íŠ¸
        curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendPhoto" \
          -F "chat_id=${{ secrets.CHAT_ID }}" \
          -F "photo=https://production.dataviz.cnn.io/index/fearandgreed/chart" \
          -F "caption=ğŸ“Š CNN ë¯¸êµ­ ì£¼ì‹ì‹œì¥ ê³µí¬íƒìš•ì§€ìˆ˜ í…ŒìŠ¤íŠ¸

        ğŸ‡ºğŸ‡¸ ë¯¸êµ­ ì£¼ì‹ì‹œì¥ ì‹¬ë¦¬ ë¶„ì„
        
        ğŸ’¡ ì§€ìˆ˜ í•´ì„:
        0-24: ê·¹ë„ì˜ ê³µí¬ ğŸ˜± (ë§¤ìˆ˜ ê¸°íšŒ)
        25-49: ê³µí¬ ğŸ˜° (ì‹ ì¤‘í•œ ë§¤ìˆ˜)
        50-74: íƒìš• ğŸ¤‘ (ì‹ ì¤‘í•œ ë§¤ë„)
        75-100: ê·¹ë„ì˜ íƒìš• ğŸ¤¯ (ë§¤ë„ ê³ ë ¤)
        
        ğŸ“ˆ CNN ê³µí¬íƒìš•ì§€ìˆ˜ëŠ” ë‹¤ìŒ 7ê°€ì§€ ì§€í‘œë¥¼ ì¢…í•©:
        â€¢ ì£¼ì‹ ê°€ê²© ëª¨ë©˜í…€
        â€¢ ì£¼ì‹ ê°€ê²© ê°•ë„ 
        â€¢ ì£¼ì‹ ê°€ê²© í­
        â€¢ í’‹/ì½œ ì˜µì…˜ ë¹„ìœ¨
        â€¢ ì‹œì¥ ë³€ë™ì„± (VIX)
        â€¢ ì•ˆì „ìì‚° ìˆ˜ìš”
        â€¢ ì •í¬ë³¸ë“œ ìˆ˜ìš”
        
        ğŸ“… $(TZ='Asia/Seoul' date '+%Yë…„ %mì›” %dì¼ %H:%M KST')
        ğŸ“Š ë°ì´í„°: CNN Markets
        
        âœ… ì´ë¯¸ì§€ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!"
        
        echo "ê³µí¬íƒìš•ì§€ìˆ˜ ì´ë¯¸ì§€ í…ŒìŠ¤íŠ¸ ì™„ë£Œ"

    - name: Alternative Image URL Test
      run: |
        echo "ëŒ€ì²´ ì´ë¯¸ì§€ URL í…ŒìŠ¤íŠ¸ ì‹œì‘"
        sleep 3
        
        # ë§Œì•½ CNN ì´ë¯¸ì§€ê°€ ì•ˆ ë˜ë©´ ëŒ€ì²´ ì´ë¯¸ì§€ í…ŒìŠ¤íŠ¸
        curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendPhoto" \
          -F "chat_id=${{ secrets.CHAT_ID }}" \
          -F "photo=https://alternative.me/crypto/fear-and-greed-index.png" \
          -F "caption=ğŸ“Š ëŒ€ì²´ ê³µí¬íƒìš•ì§€ìˆ˜ ì´ë¯¸ì§€ í…ŒìŠ¤íŠ¸

        ğŸ”„ ë§Œì•½ CNN ì´ë¯¸ì§€ê°€ ì‘ë™í•˜ì§€ ì•Šì„ ê²½ìš°ì˜ ëŒ€ì²´ ì´ë¯¸ì§€ì…ë‹ˆë‹¤.
        
        âš ï¸ ì´ê²ƒì€ ì•”í˜¸í™”í ê³µí¬íƒìš•ì§€ìˆ˜ì´ë¯€ë¡œ ì‹¤ì œ ì‚¬ìš©ì—ì„œëŠ” CNN ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
        
        ğŸ“… $(TZ='Asia/Seoul' date '+%Yë…„ %mì›” %dì¼ %H:%M KST')
        
        âœ… ëŒ€ì²´ ì´ë¯¸ì§€ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!"
        
        echo "ëŒ€ì²´ ì´ë¯¸ì§€ í…ŒìŠ¤íŠ¸ ì™„ë£Œ"

    - name: Image URL Validation Test
      run: |
        echo "ì´ë¯¸ì§€ URL ìœ íš¨ì„± ê²€ì‚¬ ì‹œì‘"
        sleep 3
        
        # CNN ì´ë¯¸ì§€ URL ì§ì ‘ í™•ì¸
        cnn_response=$(curl -s -I "https://production.dataviz.cnn.io/index/fearandgreed/chart")
        echo "CNN ì´ë¯¸ì§€ URL ì‘ë‹µ: $cnn_response"
        
        # ì‘ë‹µ ì½”ë“œ í™•ì¸
        if echo "$cnn_response" | grep -q "200 OK"; then
          status="âœ… CNN ì´ë¯¸ì§€ URL ì •ìƒ ì‘ë™"
        else
          status="âŒ CNN ì´ë¯¸ì§€ URL ë¬¸ì œ ìˆìŒ"
        fi
        
        # ê²°ê³¼ ë©”ì‹œì§€ ì „ì†¡
        curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage" \
          -d "chat_id=${{ secrets.CHAT_ID }}" \
          -d "text=ğŸ” ì´ë¯¸ì§€ URL ê²€ì‚¬ ê²°ê³¼

        ğŸ“Š CNN ê³µí¬íƒìš•ì§€ìˆ˜ ì´ë¯¸ì§€ URL:
        https://production.dataviz.cnn.io/index/fearandgreed/chart
        
        ${status}
        
        ğŸ“… $(TZ='Asia/Seoul' date '+%Yë…„ %mì›” %dì¼ %H:%M KST')
        
        ğŸ’¡ ì°¸ê³ : ì´ë¯¸ì§€ê°€ ì „ì†¡ë˜ì§€ ì•Šìœ¼ë©´ í…ìŠ¤íŠ¸ë¡œë§Œ ì •ë³´ë¥¼ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
        
        echo "ì´ë¯¸ì§€ URL ê²€ì‚¬ ì™„ë£Œ"
