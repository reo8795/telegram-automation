name: Alternative Fear Greed Test

on:
  workflow_dispatch:

jobs:
  test-alternative-images:
    runs-on: ubuntu-latest
    
    steps:
    - name: Test CNN API Data
      run: |
        echo "CNN API ë°ì´í„° í…ŒìŠ¤íŠ¸ ì‹œì‘"
        
        # CNN ê³µí¬íƒìš•ì§€ìˆ˜ APIì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        cnn_data=$(curl -s "https://production.dataviz.cnn.io/index/fearandgreed/graphdata")
        echo "CNN API ì‘ë‹µ: $cnn_data"
        
        if [ ! -z "$cnn_data" ] && echo "$cnn_data" | grep -q "fear_and_greed"; then
          # ë°ì´í„° íŒŒì‹±
          fear_greed_score=$(echo "$cnn_data" | grep -o '"score":[0-9]*' | head -1 | cut -d':' -f2)
          fear_greed_rating=$(echo "$cnn_data" | grep -o '"rating":"[^"]*' | head -1 | cut -d'"' -f4)
          fear_greed_timestamp=$(echo "$cnn_data" | grep -o '"timestamp":"[^"]*' | head -1 | cut -d'"' -f4)
          
          if [ -z "$fear_greed_score" ]; then
            fear_greed_score="50"
            fear_greed_rating="Neutral"
          fi
          
          # í•œê¸€ ë³€í™˜
          case "$fear_greed_rating" in
            "Extreme Fear") korean_rating="ê·¹ë„ì˜ ê³µí¬" ;;
            "Fear") korean_rating="ê³µí¬" ;;
            "Neutral") korean_rating="ì¤‘ë¦½" ;;
            "Greed") korean_rating="íƒìš•" ;;
            "Extreme Greed") korean_rating="ê·¹ë„ì˜ íƒìš•" ;;
            *) korean_rating="$fear_greed_rating" ;;
          esac
          
          # ì´ëª¨ì§€ ì„ íƒ
          if [ "$fear_greed_score" -le 24 ]; then
            emoji="ğŸ˜±"
          elif [ "$fear_greed_score" -le 49 ]; then
            emoji="ğŸ˜°"
          elif [ "$fear_greed_score" -le 74 ]; then
            emoji="ğŸ¤‘"
          else
            emoji="ğŸ¤¯"
          fi
          
          # ë©”ì‹œì§€ ì „ì†¡ (ì´ë¯¸ì§€ ì—†ì´)
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage" \
            -d "chat_id=${{ secrets.CHAT_ID }}" \
            -d "text=${emoji} CNN ë¯¸êµ­ ì£¼ì‹ì‹œì¥ ê³µí¬íƒìš•ì§€ìˆ˜

          í˜„ì¬ ì§€ìˆ˜: ${fear_greed_score}/100
          ìƒíƒœ: ${korean_rating}
          
          ğŸ’¡ ì§€ìˆ˜ í•´ì„:
          0-24: ê·¹ë„ì˜ ê³µí¬ ğŸ˜± (ë§¤ìˆ˜ ê¸°íšŒ)
          25-49: ê³µí¬ ğŸ˜° (ì‹ ì¤‘í•œ ë§¤ìˆ˜)
          50-74: íƒìš• ğŸ¤‘ (ì‹ ì¤‘í•œ ë§¤ë„)
          75-100: ê·¹ë„ì˜ íƒìš• ğŸ¤¯ (ë§¤ë„ ê³ ë ¤)
          
          ğŸ“ˆ CNN ê³µí¬íƒìš•ì§€ìˆ˜ 7ê°€ì§€ ì§€í‘œ:
          â€¢ ì£¼ì‹ ê°€ê²© ëª¨ë©˜í…€
          â€¢ ì£¼ì‹ ê°€ê²© ê°•ë„
          â€¢ ì£¼ì‹ ê°€ê²© í­
          â€¢ í’‹/ì½œ ì˜µì…˜ ë¹„ìœ¨
          â€¢ ì‹œì¥ ë³€ë™ì„± (VIX)
          â€¢ ì•ˆì „ìì‚° ìˆ˜ìš”
          â€¢ ì •í¬ë³¸ë“œ ìˆ˜ìš”
          
          ğŸ“… $(TZ='Asia/Seoul' date '+%Yë…„ %mì›” %dì¼ %H:%M KST')
          ğŸ“Š ë°ì´í„°: CNN Markets (API)
          
          âš ï¸ ì´ë¯¸ì§€ëŠ” ì ‘ê·¼ ì œí•œìœ¼ë¡œ í…ìŠ¤íŠ¸ë¡œë§Œ ì œê³µë©ë‹ˆë‹¤."
          
          echo "âœ… CNN API ë°ì´í„° ì „ì†¡ ì„±ê³µ"
        else
          echo "âŒ CNN API ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨"
        fi

    - name: Test MacroMicro Image
      run: |
        echo "MacroMicro ì´ë¯¸ì§€ í…ŒìŠ¤íŠ¸ ì‹œì‘"
        sleep 3
        
        # MacroMicro ì°¨íŠ¸ ì´ë¯¸ì§€ ì‹œë„ (ì—¬ëŸ¬ URL í…ŒìŠ¤íŠ¸)
        macromicro_urls=(
          "https://en.macromicro.me/charts/data/50108.png"
          "https://macromicro.me/charts/50108/cnn-fear-and-greed.png"
          "https://en.macromicro.me/charts/50108.png"
        )
        
        for url in "${macromicro_urls[@]}"; do
          echo "MacroMicro URL í…ŒìŠ¤íŠ¸: $url"
          
          response=$(curl -s -I "$url")
          if echo "$response" | grep -q "200 OK"; then
            echo "âœ… $url ì ‘ê·¼ ê°€ëŠ¥"
            
            # ì´ë¯¸ì§€ ì „ì†¡ ì‹œë„
            curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendPhoto" \
              -F "chat_id=${{ secrets.CHAT_ID }}" \
              -F "photo=$url" \
              -F "caption=ğŸ“Š MacroMicro CNN ê³µí¬íƒìš•ì§€ìˆ˜

            ğŸŒ ëŒ€ì²´ ì´ë¯¸ì§€ ì†ŒìŠ¤: MacroMicro
            
            ğŸ’¡ ì´ê²ƒì€ CNN ê³µí¬íƒìš•ì§€ìˆ˜ì˜ ì°¨íŠ¸ì…ë‹ˆë‹¤.
            
            ğŸ“ˆ 7ê°€ì§€ ì§€í‘œë¥¼ ì¢…í•©í•œ ë¯¸êµ­ ì£¼ì‹ì‹œì¥ ì‹¬ë¦¬ ë¶„ì„
            
            ğŸ“… $(TZ='Asia/Seoul' date '+%Yë…„ %mì›” %dì¼ %H:%M KST')
            ğŸ“Š ì´ë¯¸ì§€ ì œê³µ: MacroMicro
            
            âœ… ëŒ€ì²´ ì´ë¯¸ì§€ ì „ì†¡ ì„±ê³µ!"
            
            echo "âœ… MacroMicro ì´ë¯¸ì§€ ì „ì†¡ ì„±ê³µ"
            break
          else
            echo "âŒ $url ì ‘ê·¼ ì‹¤íŒ¨"
          fi
        done

    - name: Test Text-Only High Quality Format
      run: |
        echo "ê³ í’ˆì§ˆ í…ìŠ¤íŠ¸ í˜•ì‹ í…ŒìŠ¤íŠ¸ ì‹œì‘"
        sleep 3
        
        # ì´ë¯¸ì§€ ì—†ì´ ê³ í’ˆì§ˆ í…ìŠ¤íŠ¸ í˜•íƒœë¡œ ê³µí¬íƒìš•ì§€ìˆ˜ í‘œí˜„
        curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage" \
          -d "chat_id=${{ secrets.CHAT_ID }}" \
          -d "text=ğŸ“Š CNN ë¯¸êµ­ ì£¼ì‹ì‹œì¥ ê³µí¬íƒìš•ì§€ìˆ˜

        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘     í˜„ì¬ ì‹œì¥ ì‹¬ë¦¬ ë¶„ì„      â•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        ğŸ¯ í˜„ì¬ ì§€ìˆ˜: [ì‹¤ì‹œê°„ API í˜¸ì¶œ í•„ìš”]
        ğŸ“ˆ ì‹œì¥ ìƒíƒœ: [Fear/Neutral/Greed]
        
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  7ê°€ì§€ í•µì‹¬ ì§€í‘œ ë¶„ì„        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        
        ğŸ“Š 1. ì£¼ì‹ ê°€ê²© ëª¨ë©˜í…€
        ğŸ“ˆ 2. ì£¼ì‹ ê°€ê²© ê°•ë„
        ğŸ“‰ 3. ì£¼ì‹ ê°€ê²© í­
        âš–ï¸ 4. í’‹/ì½œ ì˜µì…˜ ë¹„ìœ¨
        ğŸ“¡ 5. ì‹œì¥ ë³€ë™ì„± (VIX)
        ğŸ›ï¸ 6. ì•ˆì „ìì‚° ìˆ˜ìš”
        ğŸ’° 7. ì •í¬ë³¸ë“œ ìˆ˜ìš”
        
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚        íˆ¬ì ê°€ì´ë“œ          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        
        ğŸ˜± 0-24: ê·¹ë„ì˜ ê³µí¬ â†’ ë§¤ìˆ˜ ê¸°íšŒ
        ğŸ˜° 25-49: ê³µí¬ â†’ ì‹ ì¤‘í•œ ë§¤ìˆ˜
        ğŸ¤‘ 50-74: íƒìš• â†’ ì‹ ì¤‘í•œ ë§¤ë„
        ğŸ¤¯ 75-100: ê·¹ë„ì˜ íƒìš• â†’ ë§¤ë„ ê³ ë ¤
        
        ğŸ“… $(TZ='Asia/Seoul' date '+%Yë…„ %mì›” %dì¼ %H:%M KST')
        ğŸ“Š ë°ì´í„°: CNN Markets
        ğŸ”— ì›ë³¸: https://www.cnn.com/markets/fear-and-greed
        
        âš¡ ì´ë¯¸ì§€ ì ‘ê·¼ ì œí•œìœ¼ë¡œ ê³ í’ˆì§ˆ í…ìŠ¤íŠ¸ í˜•íƒœë¡œ ì œê³µ"
        
        echo "âœ… ê³ í’ˆì§ˆ í…ìŠ¤íŠ¸ í˜•ì‹ ì „ì†¡ ì™„ë£Œ"

    - name: Test TradingView Fear Greed
      run: |
        echo "TradingView ëŒ€ì²´ ë°©ë²• í…ŒìŠ¤íŠ¸"
        sleep 3
        
        # TradingView ìœ„ì ¯ ë§í¬ë¡œ ëŒ€ì²´
        curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage" \
          -d "chat_id=${{ secrets.CHAT_ID }}" \
          -d "text=ğŸ“Š ë¯¸êµ­ ì£¼ì‹ì‹œì¥ ê³µí¬íƒìš•ì§€ìˆ˜ (ëŒ€ì²´ ë°©ë²•)

        ğŸ”— ì‹¤ì‹œê°„ ì°¨íŠ¸ í™•ì¸:
        
        ğŸ“ˆ TradingView ì‹œì¥ ì‹¬ë¦¬:
        https://www.tradingview.com/markets/stocks-usa/market-movers-overview/
        
        ğŸ“Š CNN ê³µí¬íƒìš•ì§€ìˆ˜:
        https://www.cnn.com/markets/fear-and-greed
        
        ğŸ“‰ VIX ë³€ë™ì„± ì§€ìˆ˜:
        https://finance.yahoo.com/quote/%5EVIX
        
        ğŸ’¹ S&P 500 ëª¨ë©˜í…€:
        https://finance.yahoo.com/quote/%5EGSPC
        
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    ì‹¤ì‹œê°„ ì‹œì¥ ì§€í‘œ ëª¨ìŒ     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        
        ğŸ“Š ëŒ€í™”í˜• ì°¨íŠ¸ì™€ ë¶„ì„ì„ ìœ„í•´ì„œëŠ”
        ìœ„ì˜ ë§í¬ë“¤ì„ ì§ì ‘ í™•ì¸í•˜ì„¸ìš”!
        
        ğŸ“… $(TZ='Asia/Seoul' date '+%Yë…„ %mì›” %dì¼ %H:%M KST')
        
        âœ… ëŒ€ì²´ ë§í¬ ì œê³µ ì™„ë£Œ"
        
        echo "âœ… ëŒ€ì²´ ë§í¬ ë°©ë²• ì™„ë£Œ"
