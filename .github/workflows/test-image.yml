name: Tesla Technical Analysis Test

on:
  workflow_dispatch:

jobs:
  tesla-analysis:
    runs-on: ubuntu-latest
    
    steps:
    - name: Get Tesla Real Time Data and Technical Analysis
      run: |
        echo "í…ŒìŠ¬ë¼ ì‹¤ì‹œê°„ ë°ì´í„° ë° ê¸°ìˆ ì  ë¶„ì„ ì‹œì‘"
        
        # Yahoo Finance APIì—ì„œ í…ŒìŠ¬ë¼ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        tsla_data=$(curl -s "https://query1.finance.yahoo.com/v8/finance/chart/TSLA?range=3mo&interval=1d")
        
        if [ ! -z "$tsla_data" ] && echo "$tsla_data" | grep -q "regularMarketPrice"; then
          echo "í…ŒìŠ¬ë¼ ë°ì´í„° ìˆ˜ì‹  ì„±ê³µ"
          
          # í˜„ì¬ ê°€ê²© ì¶”ì¶œ
          current_price=$(echo "$tsla_data" | grep -o '"regularMarketPrice":[0-9.]*' | head -1 | cut -d':' -f2)
          previous_close=$(echo "$tsla_data" | grep -o '"previousClose":[0-9.]*' | head -1 | cut -d':' -f2)
          day_high=$(echo "$tsla_data" | grep -o '"regularMarketDayHigh":[0-9.]*' | head -1 | cut -d':' -f2)
          day_low=$(echo "$tsla_data" | grep -o '"regularMarketDayLow":[0-9.]*' | head -1 | cut -d':' -f2)
          volume=$(echo "$tsla_data" | grep -o '"regularMarketVolume":[0-9]*' | head -1 | cut -d':' -f2)
          
          # ë³€í™”ëŸ‰ ê³„ì‚°
          if [ ! -z "$current_price" ] && [ ! -z "$previous_close" ]; then
            change=$(echo "$current_price - $previous_close" | bc -l)
            change_percent=$(echo "scale=2; ($change / $previous_close) * 100" | bc -l)
          else
            current_price="245.50"
            previous_close="243.20"
            change="2.30"
            change_percent="0.95"
            day_high="248.90"
            day_low="241.80"
            volume="45000000"
          fi
          
          # ì¶”ì„¸ íŒë‹¨
          if (( $(echo "$change >= 0" | bc -l) )); then
            trend_emoji="ğŸ“ˆ"
            trend_text="ìƒìŠ¹"
            sign="+"
          else
            trend_emoji="ğŸ“‰"
            trend_text="í•˜ë½"
            sign=""
          fi
          
          # ì¼ì¤‘ ë³€ë™í­ ê³„ì‚°
          daily_range=$(echo "scale=2; (($day_high - $day_low) / $current_price) * 100" | bc -l)
          
          # í˜„ì¬ê°€ ìœ„ì¹˜ (ì¼ì¤‘ êµ¬ê°„ì—ì„œ)
          price_position=$(echo "scale=2; (($current_price - $day_low) / ($day_high - $day_low)) * 100" | bc -l)
          
          # ì§€ì§€/ì €í•­ì„  ê³„ì‚° (ê°„ë‹¨í•œ ë°©ë²•)
          support_1=$(echo "scale=2; $current_price * 0.95" | bc -l)
          support_2=$(echo "scale=2; $current_price * 0.90" | bc -l)
          resistance_1=$(echo "scale=2; $current_price * 1.05" | bc -l)
          resistance_2=$(echo "scale=2; $current_price * 1.10" | bc -l)
          
          # RSI ì¶”ì • (ë³€í™”ìœ¨ ê¸°ë°˜ ê°„ë‹¨ ê³„ì‚°)
          if (( $(echo "$change_percent > 3" | bc -l) )); then
            rsi_estimate="75"
            rsi_status="ê³¼ë§¤ìˆ˜ ê²½í–¥"
          elif (( $(echo "$change_percent < -3" | bc -l) )); then
            rsi_estimate="25"
            rsi_status="ê³¼ë§¤ë„ ê²½í–¥"
          elif (( $(echo "$change_percent > 1" | bc -l) )); then
            rsi_estimate="65"
            rsi_status="ê°•ì„¸"
          elif (( $(echo "$change_percent < -1" | bc -l) )); then
            rsi_estimate="35"
            rsi_status="ì•½ì„¸"
          else
            rsi_estimate="50"
            rsi_status="ì¤‘ë¦½"
          fi
          
          # ë³¼ë¥¨ ë¶„ì„
          avg_volume="35000000"  # í‰ê·  ê±°ë˜ëŸ‰ ì¶”ì •ì¹˜
          if [ "$volume" -gt "$avg_volume" ]; then
            volume_status="í‰ê·  ì´ìƒ (${volume})"
            volume_signal="ê±°ë˜ëŸ‰ ì¦ê°€"
          else
            volume_status="í‰ê·  ì´í•˜ (${volume})"
            volume_signal="ê±°ë˜ëŸ‰ ê°ì†Œ"
          fi
          
          # ë³€ë™ì„± ë¶„ì„
          if (( $(echo "$daily_range > 5" | bc -l) )); then
            volatility_status="ë†’ì€ ë³€ë™ì„± (${daily_range}%)"
          elif (( $(echo "$daily_range > 3" | bc -l) )); then
            volatility_status="ë³´í†µ ë³€ë™ì„± (${daily_range}%)"
          else
            volatility_status="ë‚®ì€ ë³€ë™ì„± (${daily_range}%)"
          fi
          
          # ê°€ê²© ìœ„ì¹˜ ë¶„ì„
          if (( $(echo "$price_position > 80" | bc -l) )); then
            position_status="ì¼ì¤‘ ê³ ì  ê·¼ì²˜ (ìƒìœ„ ${price_position}%)"
            position_signal="ì €í•­ ê·¼ì ‘"
          elif (( $(echo "$price_position < 20" | bc -l) )); then
            position_status="ì¼ì¤‘ ì €ì  ê·¼ì²˜ (í•˜ìœ„ ${price_position}%)"
            position_signal="ì§€ì§€ ê·¼ì ‘"
          else
            position_status="ì¼ì¤‘ ì¤‘ê°„ êµ¬ê°„ (${price_position}%)"
            position_signal="ì¤‘ë¦½"
          fi
          
        else
          echo "í…ŒìŠ¬ë¼ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨, ì˜ˆì‹œ ë°ì´í„° ì‚¬ìš©"
          current_price="245.50"
          previous_close="243.20"
          change="2.30"
          change_percent="0.95"
          day_high="248.90"
          day_low="241.80"
          volume="45000000"
          trend_emoji="ğŸ“ˆ"
          trend_text="ìƒìŠ¹"
          sign="+"
          daily_range="2.85"
          price_position="65.5"
          support_1="233.23"
          support_2="220.95"
          resistance_1="257.78"
          resistance_2="270.05"
          rsi_estimate="58"
          rsi_status="ì¤‘ë¦½"
          volume_status="í‰ê·  ì´ìƒ"
          volume_signal="ê±°ë˜ëŸ‰ ì¦ê°€"
          volatility_status="ë‚®ì€ ë³€ë™ì„±"
          position_status="ì¼ì¤‘ ì¤‘ê°„ êµ¬ê°„"
          position_signal="ì¤‘ë¦½"
        fi
        
        # ì¢…í•© ê¸°ìˆ ì  ë¶„ì„ ë©”ì‹œì§€ ì „ì†¡
        curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage" \
          -d "chat_id=${{ secrets.CHAT_ID }}" \
          -d "text=ğŸš— TSLA (í…ŒìŠ¬ë¼) ì‹¤ì‹œê°„ ê¸°ìˆ ì  ë¶„ì„

        ğŸ’° í˜„ì¬ê°€: \$${current_price}
        ğŸ“Š ë³€ë™: ${sign}${change} (${sign}${change_percent}%) ${trend_emoji}
        ğŸ“ˆ ì¼ì¤‘ ê³ ê°€: \$${day_high}
        ğŸ“‰ ì¼ì¤‘ ì €ê°€: \$${day_low}
        
        â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        
        ğŸ¯ ì§€ì§€/ì €í•­ì„  ë¶„ì„:
        ğŸ”´ 1ì°¨ ì €í•­: \$${resistance_1}
        ğŸ”´ 2ì°¨ ì €í•­: \$${resistance_2}
        ğŸŸ¢ 1ì°¨ ì§€ì§€: \$${support_1}
        ğŸŸ¢ 2ì°¨ ì§€ì§€: \$${support_2}
        
        ğŸ“Š ê¸°ìˆ ì  ì§€í‘œ:
        â€¢ RSI ì¶”ì •: ${rsi_estimate} (${rsi_status})
        â€¢ ê°€ê²© ìœ„ì¹˜: ${position_status}
        â€¢ ì‹ í˜¸: ${position_signal}
        
        ğŸ“ˆ ê±°ë˜ëŸ‰ ë¶„ì„:
        â€¢ ì˜¤ëŠ˜ ê±°ë˜ëŸ‰: ${volume_status}
        â€¢ ì‹œê·¸ë„: ${volume_signal}
        
        ğŸ“‰ ë³€ë™ì„± ë¶„ì„:
        â€¢ ì¼ì¤‘ ë³€ë™í­: ${volatility_status}
        â€¢ íŠ¸ë Œë“œ: ${trend_text} ëª¨ë©˜í…€
        
        â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        
        ğŸ’¡ ê¸°ìˆ ì  ë¶„ì„ ìš”ì•½:
        â€¢ ë‹¨ê¸° ì¶”ì„¸: ${trend_text} (${change_percent}%)
        â€¢ í•µì‹¬ ì§€ì§€ì„ : \$${support_1}
        â€¢ í•µì‹¬ ì €í•­ì„ : \$${resistance_1}
        â€¢ RSI ìƒíƒœ: ${rsi_status}
        â€¢ ê±°ë˜ëŸ‰: ${volume_signal}
        
        ğŸ”— ì‹¤ì‹œê°„ ì°¨íŠ¸: https://finance.yahoo.com/quote/TSLA
        ğŸ“Š ìƒì„¸ ë¶„ì„: https://www.tradingview.com/symbols/TSLA
        
        ğŸ“… $(TZ='Asia/Seoul' date '+%Yë…„ %mì›” %dì¼ %H:%M KST')
        
        âš ï¸ íˆ¬ì ì°¸ê³ ìš©ì´ë©° ì‹¤ì œ íˆ¬ì ê²°ì •ì€ ì‹ ì¤‘í•˜ê²Œ í•˜ì„¸ìš”."
        
        echo "âœ… í…ŒìŠ¬ë¼ ê¸°ìˆ ì  ë¶„ì„ ì „ì†¡ ì™„ë£Œ"

    - name: Send Technical Analysis Summary
      run: |
        sleep 3
        echo "ê¸°ìˆ ì  ë¶„ì„ ë°©ë²•ë¡  ì„¤ëª…"
        
        curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage" \
          -d "chat_id=${{ secrets.CHAT_ID }}" \
          -d "text=ğŸ“š ê¸°ìˆ ì  ë¶„ì„ ë°©ë²•ë¡  ì„¤ëª…

        ğŸ” ì´ ë¶„ì„ì—ì„œ ì‚¬ìš©í•œ ì§€í‘œë“¤:

        ğŸ“Š ì§€ì§€/ì €í•­ì„ :
        â€¢ í˜„ì¬ê°€ ê¸°ì¤€ Â±5%, Â±10% ê³„ì‚°
        â€¢ ì‹¤ì œë¡œëŠ” ê³¼ê±° ê³ ì /ì €ì  í™œìš© í•„ìš”

        ğŸ“ˆ RSI (ìƒëŒ€ê°•ë„ì§€ìˆ˜):
        â€¢ ì¼ì¼ ë³€í™”ìœ¨ ê¸°ë°˜ ì¶”ì •
        â€¢ 70 ì´ìƒ: ê³¼ë§¤ìˆ˜, 30 ì´í•˜: ê³¼ë§¤ë„
        â€¢ ì‹¤ì œë¡œëŠ” 14ì¼ RSI ê³„ì‚° í•„ìš”

        ğŸ“Š ê±°ë˜ëŸ‰ ë¶„ì„:
        â€¢ í‰ê·  ê±°ë˜ëŸ‰ê³¼ ë¹„êµ
        â€¢ ê°€ê²© ìƒìŠ¹ + ê±°ë˜ëŸ‰ ì¦ê°€ = ê°•í•œ ì‹ í˜¸

        ğŸ“‰ ë³€ë™ì„± ë¶„ì„:
        â€¢ ì¼ì¤‘ ê³ ì €ì  ì°¨ì´ë¡œ ê³„ì‚°
        â€¢ 5% ì´ìƒ: ë†’ì€ ë³€ë™ì„±

        ğŸ¯ ê°€ê²© ìœ„ì¹˜:
        â€¢ ì¼ì¤‘ êµ¬ê°„ì—ì„œ í˜„ì¬ê°€ ìœ„ì¹˜
        â€¢ 80% ì´ìƒ: ê³ ì  ê·¼ì²˜
        â€¢ 20% ì´í•˜: ì €ì  ê·¼ì²˜

        ğŸ’¡ ì°¸ê³ ì‚¬í•­:
        â€¢ ì´ê²ƒì€ ê¸°ë³¸ì ì¸ ê¸°ìˆ ì  ë¶„ì„ì…ë‹ˆë‹¤
        â€¢ ì‹¤ì œ íˆ¬ì ì‹œì—ëŠ” ë” ì •êµí•œ ë¶„ì„ í•„ìš”
        â€¢ ì—¬ëŸ¬ ì§€í‘œë¥¼ ì¢…í•©ì ìœ¼ë¡œ íŒë‹¨í•˜ì„¸ìš”
        
        ğŸ“… $(TZ='Asia/Seoul' date '+%Yë…„ %mì›” %dì¼ %H:%M KST')"
