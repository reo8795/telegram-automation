name: Telegram Auto Alert

on:
  workflow_dispatch:
  schedule:
    - cron: '0 22 * * *'

jobs:
  send-telegram:
    runs-on: ubuntu-latest
    
    steps:
    - name: Send Test Message
      run: |
        curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage" \
          -d "chat_id=${{ secrets.CHAT_ID }}" \
          -d "text=🤖 GitHub Actions Test

        ✅ System is working!
        
        📊 Features:
        • Daily Fear Greed Index at 07:00 KST
        • Stock info every 4 hours
        • Auto scheduling
        
        🕐 Current time: $(date)
        
        🚀 All systems go!"

    - name: Send Fear Greed Index
      run: |
        response=$(curl -s "https://api.alternative.me/fng/")
        value=$(echo "$response" | grep -o '"value":"[^"]*' | head -1 | cut -d'"' -f4)
        classification=$(echo "$response" | grep -o '"value_classification":"[^"]*' | head -1 | cut -d'"' -f4)
        
        if [ -z "$value" ]; then
          value="50"
          classification="Neutral"
        fi
        
        if [ "$value" -le 24 ]; then
          emoji="😱"
        elif [ "$value" -le 49 ]; then
          emoji="😰"
        elif [ "$value" -le 74 ]; then
          emoji="🤑"
        else
          emoji="🤯"
        fi
        
        curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage" \
          -d "chat_id=${{ secrets.CHAT_ID }}" \
          -d "text=${emoji} Fear and Greed Index

        Current Index: ${value}/100
        Status: ${classification}
        
        💡 Index Guide:
        0-24: Extreme Fear 😱
        25-49: Fear 😰
        50-74: Greed 🤑
        75-100: Extreme Greed 🤯
        
        📅 Time: $(date)
        📊 Source: Alternative.me"

    - name: Send Stock Info
      run: |
        curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage" \
          -d "chat_id=${{ secrets.CHAT_ID }}" \
          -d "text=📱 AAPL Stock Info

        💰 Live Data:
        📈 Yahoo Finance: https://finance.yahoo.com/quote/AAPL
        📊 TradingView: https://www.tradingview.com/symbols/AAPL
        📰 News: https://finance.yahoo.com/quote/AAPL/news
        
        📅 Time: $(date)"
        
        sleep 3
        
        curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage" \
          -d "chat_id=${{ secrets.CHAT_ID }}" \
          -d "text=🚗 TSLA Stock Info

        💰 Live Data:
        📈 Yahoo Finance: https://finance.yahoo.com/quote/TSLA
        📊 TradingView: https://www.tradingview.com/symbols/TSLA
        📰 News: https://finance.yahoo.com/quote/TSLA/news
        
        📅 Time: $(date)"
