name: Stock News Korean Translation System

on:
  workflow_dispatch:
  schedule:
    - cron: '0 22 * * *'      # ë§¤ì¼ 07:00 KST (ê³µí¬íƒìš•ì§€ìˆ˜)
    - cron: '0 */3 * * *'     # 3ì‹œê°„ë§ˆë‹¤ (ì¢…ëª© ë‰´ìŠ¤)

jobs:
  # ë§¤ì¼ ì•„ì¹¨ 7ì‹œ - ë¯¸êµ­ ì£¼ì‹ ê³µí¬íƒìš•ì§€ìˆ˜ë§Œ
  morning-us-fear-greed:
    runs-on: ubuntu-latest
    if: github.event.schedule == '0 22 * * *' || github.event_name == 'workflow_dispatch'
    
    steps:
    - name: Send US Stock Fear Greed Index Only
      run: |
        echo "ë¯¸êµ­ ì£¼ì‹ ê³µí¬íƒìš•ì§€ìˆ˜ ì „ì†¡ ì‹œì‘"
        
        # CNN ë¯¸êµ­ ì£¼ì‹ ê³µí¬íƒìš•ì§€ìˆ˜ë§Œ ì‹œë„ (ì•”í˜¸í™”í ì œì™¸)
        us_stock_image_urls=(
          "https://production.dataviz.cnn.io/index/fearandgreed/chart"
          "https://en.macromicro.me/charts/50108/cnn-fear-and-greed.png"
        )
        
        success=false
        
        for url in "${us_stock_image_urls[@]}"; do
          echo "ë¯¸êµ­ ì£¼ì‹ ê³µí¬íƒìš•ì§€ìˆ˜ ì´ë¯¸ì§€ ì‹œë„: $url"
          
          response=$(curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendPhoto" \
            -F "chat_id=${{ secrets.CHAT_ID }}" \
            -F "photo=$url" \
            -F "caption=ğŸ“Š CNN ë¯¸êµ­ ì£¼ì‹ì‹œì¥ ê³µí¬íƒìš•ì§€ìˆ˜

          ğŸ’¡ íˆ¬ì ê°€ì´ë“œ:
          ğŸ˜± 0-24: ê·¹ë„ì˜ ê³µí¬ (ë§¤ìˆ˜ ê¸°íšŒ)
          ğŸ˜° 25-49: ê³µí¬ (ì‹ ì¤‘í•œ ë§¤ìˆ˜)
          ğŸ¤‘ 50-74: íƒìš• (ì‹ ì¤‘í•œ ë§¤ë„)
          ğŸ¤¯ 75-100: ê·¹ë„ì˜ íƒìš• (ë§¤ë„ ê³ ë ¤)
          
          ğŸ“… $(TZ='Asia/Seoul' date '+%Yë…„ %mì›” %dì¼ 07:00 KST')
          
          ğŸ”— ì‹¤ì‹œê°„ í™•ì¸: https://www.cnn.com/markets/fear-and-greed")
          
          if echo "$response" | grep -q '"ok":true'; then
            echo "âœ… ë¯¸êµ­ ì£¼ì‹ ê³µí¬íƒìš•ì§€ìˆ˜ ì´ë¯¸ì§€ ì „ì†¡ ì„±ê³µ"
            success=true
            break
          else
            echo "âŒ ì´ë¯¸ì§€ ì „ì†¡ ì‹¤íŒ¨: $url"
          fi
        done
        
        # ì´ë¯¸ì§€ ì‹¤íŒ¨ ì‹œ í…ìŠ¤íŠ¸ë¡œ ì „ì†¡ (ë¯¸êµ­ ì£¼ì‹ ì „ìš© ì•ˆë‚´)
        if [ "$success" = false ]; then
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage" \
            -d "chat_id=${{ secrets.CHAT_ID }}" \
            -d "text=ğŸ“Š CNN ë¯¸êµ­ ì£¼ì‹ì‹œì¥ ê³µí¬íƒìš•ì§€ìˆ˜

          ğŸ’¡ íˆ¬ì ê°€ì´ë“œ:
          ğŸ˜± 0-24: ê·¹ë„ì˜ ê³µí¬ (ë§¤ìˆ˜ ê¸°íšŒ)
          ğŸ˜° 25-49: ê³µí¬ (ì‹ ì¤‘í•œ ë§¤ìˆ˜)
          ğŸ¤‘ 50-74: íƒìš• (ì‹ ì¤‘í•œ ë§¤ë„)
          ğŸ¤¯ 75-100: ê·¹ë„ì˜ íƒìš• (ë§¤ë„ ê³ ë ¤)
          
          ğŸ“… $(TZ='Asia/Seoul' date '+%Yë…„ %mì›” %dì¼ 07:00 KST')
          
          ğŸ”— ì‹¤ì‹œê°„ í™•ì¸: https://www.cnn.com/markets/fear-and-greed
          ğŸ“Š ì°¨íŠ¸ ì´ë¯¸ì§€: https://production.dataviz.cnn.io/index/fearandgreed/chart
          
          âš ï¸ ì´ë¯¸ì§€ ì „ì†¡ ì‹¤íŒ¨ë¡œ ë§í¬ì—ì„œ ì§ì ‘ í™•ì¸í•´ì£¼ì„¸ìš”"
        fi

  # 3ì‹œê°„ë§ˆë‹¤ - ì¢…ëª© ë‰´ìŠ¤ í•œêµ­ì–´ ë²ˆì—­
  korean-translated-news:
    runs-on: ubuntu-latest
    if: github.event.schedule == '0 */3 * * *' || github.event_name == 'workflow_dispatch'
    
    steps:
    - name: Get News and Translate to Korean
      run: |
        echo "ì¢…ëª© ë‰´ìŠ¤ í™•ì¸ ë° í•œêµ­ì–´ ë²ˆì—­ ì‹œì‘"
        
        # ì¢…ëª© ë¦¬ìŠ¤íŠ¸
        declare -A stocks=(
          ["CRCL"]="Circle Internet Group"
          ["OSCR"]="Oscar Health"
          ["ARQQ"]="Arqit Quantum"
          ["BTM"]="Bitcoin Depot"
          ["CRWV"]="CoreWeave"
          ["GLXY"]="Galaxy Digital"
          ["NBIS"]="Nebius Group"
          ["TSLA"]="Tesla"
          ["OKLO"]="Oklo"
          ["MRVL"]="Marvell Technology"
          ["PLTR"]="Palantir"
          ["AEVA"]="Aeva Technologies"
        )
        
        # ê°„ë‹¨í•œ ì˜ì–´-í•œêµ­ì–´ ë²ˆì—­ í•¨ìˆ˜
        translate_to_korean() {
          local english_text="$1"
          
          # ê¸°ë³¸ì ì¸ ë‹¨ì–´ ë²ˆì—­ (íŒ¨í„´ ë§¤ì¹­)
          korean_text="$english_text"
          
          # ì¼ë°˜ì ì¸ ì£¼ì‹ ìš©ì–´ ë²ˆì—­
          korean_text=$(echo "$korean_text" | sed 's/\bstock\b/ì£¼ì‹/g')
          korean_text=$(echo "$korean_text" | sed 's/\bshares\b/ì£¼ì‹/g')
          korean_text=$(echo "$korean_text" | sed 's/\bearnings\b/ì‹¤ì /g')
          korean_text=$(echo "$korean_text" | sed 's/\brevenue\b/ë§¤ì¶œ/g')
          korean_text=$(echo "$korean_text" | sed 's/\bprofit\b/ì´ìµ/g')
          korean_text=$(echo "$korean_text" | sed 's/\bgains\b/ìƒìŠ¹/g')
          korean_text=$(echo "$korean_text" | sed 's/\bfalls\b/í•˜ë½/g')
          korean_text=$(echo "$korean_text" | sed 's/\brises\b/ìƒìŠ¹/g')
          korean_text=$(echo "$korean_text" | sed 's/\bdrops\b/í•˜ë½/g')
          korean_text=$(echo "$korean_text" | sed 's/\bsurges\b/ê¸‰ë“±/g')
          korean_text=$(echo "$korean_text" | sed 's/\bplunges\b/ê¸‰ë½/g')
          korean_text=$(echo "$korean_text" | sed 's/\binvestment\b/íˆ¬ì/g')
          korean_text=$(echo "$korean_text" | sed 's/\bmarket\b/ì‹œì¥/g')
          korean_text=$(echo "$korean_text" | sed 's/\bcompany\b/íšŒì‚¬/g')
          korean_text=$(echo "$korean_text" | sed 's/\bquarter\b/ë¶„ê¸°/g')
          korean_text=$(echo "$korean_text" | sed 's/\banalyst\b/ì• ë„ë¦¬ìŠ¤íŠ¸/g')
          korean_text=$(echo "$korean_text" | sed 's/\btarget\b/ëª©í‘œê°€/g')
          korean_text=$(echo "$korean_text" | sed 's/\bupgrade\b/ìƒí–¥ì¡°ì •/g')
          korean_text=$(echo "$korean_text" | sed 's/\bdowngrade\b/í•˜í–¥ì¡°ì •/g')
          korean_text=$(echo "$korean_text" | sed 's/\bbuy\b/ë§¤ìˆ˜/g')
          korean_text=$(echo "$korean_text" | sed 's/\bsell\b/ë§¤ë„/g')
          korean_text=$(echo "$korean_text" | sed 's/\bhold\b/ë³´ìœ /g')
          
          # íšŒì‚¬ë³„ íŠ¹ìˆ˜ ìš©ì–´
          korean_text=$(echo "$korean_text" | sed 's/\bTesla\b/í…ŒìŠ¬ë¼/g')
          korean_text=$(echo "$korean_text" | sed 's/\bPalantir\b/íŒ”ë€í‹°ì–´/g')
          korean_text=$(echo "$korean_text" | sed 's/\bMarvell\b/ë§ˆë²¨/g')
          korean_text=$(echo "$korean_text" | sed 's/\belectric vehicle\b/ì „ê¸°ì°¨/g')
          korean_text=$(echo "$korean_text" | sed 's/\bEV\b/ì „ê¸°ì°¨/g')
          korean_text=$(echo "$korean_text" | sed 's/\bautonomous\b/ììœ¨ì£¼í–‰/g')
          korean_text=$(echo "$korean_text" | sed 's/\bAI\b/AI/g')
          korean_text=$(echo "$korean_text" | sed 's/\bartificial intelligence\b/ì¸ê³µì§€ëŠ¥/g')
          korean_text=$(echo "$korean_text" | sed 's/\bbitcoin\b/ë¹„íŠ¸ì½”ì¸/g')
          korean_text=$(echo "$korean_text" | sed 's/\bcryptocurrency\b/ì•”í˜¸í™”í/g')
          korean_text=$(echo "$korean_text" | sed 's/\bblockchain\b/ë¸”ë¡ì²´ì¸/g')
          korean_text=$(echo "$korean_text" | sed 's/\bquantum\b/ì–‘ì/g')
          korean_text=$(echo "$korean_text" | sed 's/\bcloud\b/í´ë¼ìš°ë“œ/g')
          korean_text=$(echo "$korean_text" | sed 's/\bsemiconductor\b/ë°˜ë„ì²´/g')
          korean_text=$(echo "$korean_text" | sed 's/\bchip\b/ì¹©/g')
          
          echo "$korean_text"
        }
        
        # ë„¤ì´ë²„ ë‰´ìŠ¤ í™•ì¸ (í•œêµ­ ì¢…ëª©)
        naver_news=$(curl -s "https://news.google.com/rss/search?q=NAVER+Korea+stock+ë„¤ì´ë²„+ì£¼ì‹" | head -20)
        naver_title=$(echo "$naver_news" | grep -o '<title><!\[CDATA\[.*\]\]></title>' | head -2 | tail -1 | sed 's/<title><!\[CDATA\[//g' | sed 's/\]\]><\/title>//g')
        
        if [ ! -z "$naver_title" ] && [ "$naver_title" != "" ] && [ "$naver_title" != "Google News" ]; then
          # ë„¤ì´ë²„ ë‰´ìŠ¤ëŠ” í•œêµ­ì–´ë©´ ê·¸ëŒ€ë¡œ, ì˜ì–´ë©´ ë²ˆì—­
          if echo "$naver_title" | grep -q '[ê°€-í£]'; then
            translated_title="$naver_title"
          else
            translated_title=$(translate_to_korean "$naver_title")
          fi
          
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage" \
            -d "chat_id=${{ secrets.CHAT_ID }}" \
            -d "text=ğŸ‡°ğŸ‡· NAVER (035420) ìµœì‹  ë‰´ìŠ¤

          ğŸ“° ${translated_title}

          ğŸ”— ë‰´ìŠ¤ ë§í¬: https://news.google.com/search?q=NAVER+Korea
          ğŸ“Š ì£¼ê°€ í™•ì¸: https://finance.yahoo.com/quote/035420.KS

          ğŸ“… $(TZ='Asia/Seoul' date '+%Yë…„ %mì›” %dì¼ %H:%M KST')"
        fi
        
        # ë¯¸êµ­ ì¢…ëª©ë“¤ ë‰´ìŠ¤ í™•ì¸ ë° ë²ˆì—­
        for symbol in "${!stocks[@]}"; do
          company_name="${stocks[$symbol]}"
          echo "ë‰´ìŠ¤ í™•ì¸ ë° ë²ˆì—­ ì¤‘: $symbol ($company_name)"
          
          # Google Newsì—ì„œ ì˜ì–´ ë‰´ìŠ¤ ê²€ìƒ‰
          news_data=$(curl -s "https://news.google.com/rss/search?q=${symbol}+${company_name// /+}+stock+news" | head -20)
          
          # ìµœì‹  ë‰´ìŠ¤ ì œëª© ì¶”ì¶œ
          english_title=$(echo "$news_data" | grep -o '<title><!\[CDATA\[.*\]\]></title>' | head -2 | tail -1 | sed 's/<title><!\[CDATA\[//g' | sed 's/\]\]><\/title>//g')
          
          if [ ! -z "$english_title" ] && [ "$english_title" != "" ] && [ "$english_title" != "Google News" ]; then
            echo "ì˜ì–´ ë‰´ìŠ¤ ë°œê²¬: $symbol - $english_title"
            
            # í•œêµ­ì–´ë¡œ ë²ˆì—­
            korean_title=$(translate_to_korean "$english_title")
            
            # í•´ë‹¹ ë‰´ìŠ¤ ì§ì ‘ ë§í¬ (Google ê²€ìƒ‰ ê²°ê³¼)
            news_link="https://news.google.com/search?q=${symbol}+${company_name// /+}+stock"
            
            # ì¢…ëª©ë³„ ì´ëª¨ì§€
            case "$symbol" in
              "TSLA") emoji="ğŸš—" ;;
              "PLTR") emoji="ğŸ”" ;;
              "MRVL") emoji="ğŸ’" ;;
              "BTM") emoji="â‚¿" ;;
              "GLXY") emoji="ğŸŒŒ" ;;
              "OSCR") emoji="ğŸ¥" ;;
              "OKLO") emoji="âš›ï¸" ;;
              "AEVA") emoji="ğŸ“¡" ;;
              "NBIS") emoji="ğŸ”¬" ;;
              "ARQQ") emoji="âš›ï¸" ;;
              "CRCL") emoji="ğŸŒ" ;;
              "CRWV") emoji="â˜ï¸" ;;
              *) emoji="ğŸ“ˆ" ;;
            esac
            
            curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage" \
              -d "chat_id=${{ secrets.CHAT_ID }}" \
              -d "text=${emoji} ${symbol} (${company_name}) ìµœì‹  ë‰´ìŠ¤

            ğŸ“° ${korean_title}

            ğŸ”— ë‰´ìŠ¤ ë§í¬: ${news_link}
            ğŸ“Š ì£¼ê°€ í™•ì¸: https://finance.yahoo.com/quote/${symbol}

            ğŸ“… $(TZ='Asia/Seoul' date '+%Yë…„ %mì›” %dì¼ %H:%M KST')"
            
            sleep 3
          else
            echo "ìƒˆë¡œìš´ ë‰´ìŠ¤ ì—†ìŒ: $symbol"
          fi
          
          sleep 1
        done
        
        echo "ëª¨ë“  ì¢…ëª© ë‰´ìŠ¤ í™•ì¸ ë° ë²ˆì—­ ì™„ë£Œ"

    - name: Send Translation Summary
      run: |
        sleep 5
        
        curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage" \
          -d "chat_id=${{ secrets.CHAT_ID }}" \
          -d "text=ğŸ“Š ì¢…ëª© ë‰´ìŠ¤ ëª¨ë‹ˆí„°ë§ ì™„ë£Œ

        âœ… í™•ì¸ ì™„ë£Œëœ ì¢…ëª©ë“¤:
        ğŸŒ CRCL, ğŸ¥ OSCR, âš›ï¸ ARQQ, â‚¿ BTM
        â˜ï¸ CRWV, ğŸ‡°ğŸ‡· NAVER, ğŸŒŒ GLXY, ğŸ”¬ NBIS
        ğŸš— TSLA, âš›ï¸ OKLO, ğŸ’ MRVL, ğŸ” PLTR, ğŸ“¡ AEVA

        ğŸ“… $(TZ='Asia/Seoul' date '+%Yë…„ %mì›” %dì¼ %H:%M KST')
        â° ë‹¤ìŒ í™•ì¸: 3ì‹œê°„ í›„

        ğŸ’¡ ìƒˆë¡œìš´ ë‰´ìŠ¤ê°€ ìˆì„ ë•Œë§Œ í•œêµ­ì–´ ë²ˆì—­ê³¼ í•¨ê»˜ ì•Œë¦¼"
