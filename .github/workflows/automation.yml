name: Telegram Auto Alert

on:
  workflow_dispatch:
  schedule:
    - cron: '0 22 * * *'

jobs:
  send-telegram:
    runs-on: ubuntu-latest
    
    steps:
    - name: Send Test Message
      run: |
        curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage" \
          -d "chat_id=${{ secrets.CHAT_ID }}" \
          -d "text=ğŸ¤– GitHub Actions Test

        âœ… System is working!
        
        ğŸ“Š Features:
        â€¢ Daily Fear Greed Index at 07:00 KST
        â€¢ Stock info every 4 hours
        â€¢ Auto scheduling
        
        ğŸ• Current time: $(date)
        
        ğŸš€ All systems go!"

    - name: Send Fear Greed Index
      run: |
        response=$(curl -s "https://api.alternative.me/fng/")
        value=$(echo "$response" | grep -o '"value":"[^"]*' | head -1 | cut -d'"' -f4)
        classification=$(echo "$response" | grep -o '"value_classification":"[^"]*' | head -1 | cut -d'"' -f4)
        
        if [ -z "$value" ]; then
          value="50"
          classification="Neutral"
        fi
        
        if [ "$value" -le 24 ]; then
          emoji="ğŸ˜±"
        elif [ "$value" -le 49 ]; then
          emoji="ğŸ˜°"
        elif [ "$value" -le 74 ]; then
          emoji="ğŸ¤‘"
        else
          emoji="ğŸ¤¯"
        fi
        
        curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage" \
          -d "chat_id=${{ secrets.CHAT_ID }}" \
          -d "text=${emoji} Fear and Greed Index

        Current Index: ${value}/100
        Status: ${classification}
        
        ğŸ’¡ Index Guide:
        0-24: Extreme Fear ğŸ˜±
        25-49: Fear ğŸ˜°
        50-74: Greed ğŸ¤‘
        75-100: Extreme Greed ğŸ¤¯
        
        ğŸ“… Time: $(date)
        ğŸ“Š Source: Alternative.me"

    - name: Send Stock Info
      run: |
        curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage" \
          -d "chat_id=${{ secrets.CHAT_ID }}" \
          -d "text=ğŸ“± AAPL Stock Info

        ğŸ’° Live Data:
        ğŸ“ˆ Yahoo Finance: https://finance.yahoo.com/quote/AAPL
        ğŸ“Š TradingView: https://www.tradingview.com/symbols/AAPL
        ğŸ“° News: https://finance.yahoo.com/quote/AAPL/news
        
        ğŸ“… Time: $(date)"
        
        sleep 3
        
        curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage" \
          -d "chat_id=${{ secrets.CHAT_ID }}" \
          -d "text=ğŸš— TSLA Stock Info

        ğŸ’° Live Data:
        ğŸ“ˆ Yahoo Finance: https://finance.yahoo.com/quote/TSLA
        ğŸ“Š TradingView: https://www.tradingview.com/symbols/TSLA
        ğŸ“° News: https://finance.yahoo.com/quote/TSLA/news
        
        ğŸ“… Time: $(date)"
